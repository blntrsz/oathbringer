- name: Ensure systemd system directory
  ansible.builtin.file:
    path: /etc/systemd/system
    state: directory
    mode: "0755"

- name: Check opencode availability
  ansible.builtin.command: command -v opencode
  register: opencode_check
  changed_when: false
  failed_when: false

- name: Install opencode
  ansible.builtin.shell: curl -fsSL https://opencode.ai/install | bash
  when: opencode_check.rc != 0

- name: Install opencode systemd unit
  ansible.builtin.copy:
    src: systemd/opencode.service
    dest: /etc/systemd/system/opencode.service
    mode: "0644"
