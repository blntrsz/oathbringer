- name: Ensure systemd user directory
  ansible.builtin.file:
    path: ~/.config/systemd/user
    state: directory
    mode: "0755"

- name: Check opencode availability
  ansible.builtin.command: command -v opencode
  register: opencode_check
  changed_when: false
  failed_when: false

- name: Install opencode
  ansible.builtin.shell: curl -fsSL https://opencode.ai/install | bash
  when: opencode_check.rc != 0

- name: Install opencode systemd user unit
  ansible.builtin.copy:
    src: systemd/opencode.service
    dest: ~/.config/systemd/user/opencode.service
    mode: "0644"
